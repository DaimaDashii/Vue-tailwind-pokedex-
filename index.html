<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon Gallery</title>
    <script src="https://unpkg.com/vue@3.2.31/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.5s;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app" class="container mx-auto px-4 py-8">
        <h1 class="text-4xl font-bold text-center mb-8">Pokemon Gallery</h1>
        <div class="mb-4">
            <input v-model="searchQuery" @input="searchPokemon" type="text" placeholder="Search Pokemon" 
                   class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
            <div v-for="pokemon in displayedPokemon" :key="pokemon.id" 
                 class="bg-white rounded-lg shadow-md p-4 text-center cursor-pointer transition transform hover:scale-105"
                 @click="showDetails(pokemon)">
                <img :src="pokemon.image" :alt="pokemon.name" loading="lazy" class="w-24 h-24 mx-auto">
                <p class="mt-2 capitalize">{{ pokemon.name }}</p>
            </div>
        </div>
        <div class="mt-8 text-center">
            <button @click="loadPrevious" 
                    :disabled="!prevUrl || isLoading"
                    class="bg-blue-500 text-white px-4 py-2 rounded mr-2 disabled:opacity-50">
                Previous
            </button>
            <button @click="loadNext" 
                    :disabled="!nextUrl || isLoading"
                    class="bg-blue-500 text-white px-4 py-2 rounded disabled:opacity-50">
                Next
            </button>
        </div>
        <Transition name="fade">
            <div v-if="selectedPokemon" 
                 class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4"
                 @click="selectedPokemon = null">
                <div class="bg-white rounded-lg p-6 max-w-md w-full max-h-[80vh] overflow-y-auto relative" @click.stop>
                    <button @click="selectedPokemon = null" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                                        <h2 class="text-2xl font-bold mb-4 capitalize">{{ selectedPokemon.name }}</h2>
                    <div class="flex justify-center space-x-4 mb-4">
                        <div class="text-center relative">
                            <img :src="selectedPokemon.forms[0].image" :alt="selectedPokemon.forms[0].name" 
                                 class="w-24 h-24 cursor-pointer"
                                 @click="showEvolutionDetails(0)">
                            <p class="mt-1 capitalize">{{ selectedPokemon.forms[0].name }}</p>
                            <span v-if="selectedPokemon.forms.length > 1" 
                                  class="absolute top-0 right-0 text-blue-500">âžœ</span>
                        </div>
                    </div>
                    <p class="mb-2">Height: {{ selectedPokemon.height }} dm</p>
                    <p class="mb-4">Weight: {{ selectedPokemon.weight }} hg</p>
                    <h3 class="text-xl font-semibold mb-2">Abilities:</h3>
                    <ul class="list-disc list-inside mb-4">
                        <li v-for="ability in selectedPokemon.abilities" :key="ability" class="capitalize">{{ ability }}</li>
                    </ul>
                    <h3 class="text-xl font-semibold mb-2">Stats:</h3>
                    <ul class="space-y-1">
                        <li v-for="stat in selectedPokemon.stats" :key="stat.name" class="flex justify-between">
                            <span class="capitalize">{{ stat.name }}:</span>
                            <span>{{ stat.value }}</span>
                        </li>
                    </ul>
                    <div v-if="selectedPokemon.evolutionInfo" class="mt-4">
                        <h3 class="text-xl font-semibold mb-2">Evolution Info:</h3>
                        <p>{{ selectedPokemon.evolutionInfo }}</p>
                    </div>
                    <div class="mt-4 flex justify-between">
                        <button @click="navigateEvolution('prev')" 
                                :disabled="!canNavigatePrev"
                                class="bg-blue-500 text-white px-4 py-2 rounded disabled:opacity-50">
                            Previous Evolution
                        </button>
                        <button @click="navigateEvolution('next')" 
                                :disabled="!canNavigateNext"
                                class="bg-blue-500 text-white px-4 py-2 rounded disabled:opacity-50">
                            Next Evolution
                        </button>
                    </div>
                </div>
            </div>
        </Transition>
    </div>

    <script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    const evolutionCache = new Map();

    createApp({
        setup() {
            const pokemonList = ref([]);
            const allPokemon = ref([]);
            const nextUrl = ref('');
            const prevUrl = ref('');
            const currentUrl = ref('https://pokeapi.co/api/v2/pokemon?limit=1000');
            const isLoading = ref(false);
            const selectedPokemon = ref(null);
            const searchQuery = ref('');
            const currentEvolutionIndex = ref(0);

            const fetchAllPokemon = async () => {
                if (isLoading.value) return;
                isLoading.value = true;
                try {
                    const response = await axios.get(currentUrl.value);
                    allPokemon.value = await Promise.all(response.data.results.map(async (pokemon) => {
                        const id = pokemon.url.split('/')[6];
                        return {
                            id,
                            name: pokemon.name,
                                                        image: `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${id}.png`,
                            url: pokemon.url
                        };
                    }));
                    pokemonList.value = allPokemon.value.slice(0, 20);
                } catch (error) {
                    console.error('Error fetching Pokemon:', error);
                } finally {
                    isLoading.value = false;
                }
            };

            const loadNext = () => {
                const currentIndex = allPokemon.value.findIndex(p => p.id === pokemonList.value[pokemonList.value.length - 1].id);
                pokemonList.value = allPokemon.value.slice(currentIndex + 1, currentIndex + 21);
            };

            const loadPrevious = () => {
                const currentIndex = allPokemon.value.findIndex(p => p.id === pokemonList.value[0].id);
                pokemonList.value = allPokemon.value.slice(Math.max(0, currentIndex - 20), currentIndex);
            };

            const getEvolutionForms = async (chain) => {
                const cacheKey = chain.species.name;
                if (evolutionCache.has(cacheKey)) {
                    return evolutionCache.get(cacheKey);
                }

                let forms = [];
                let currentForm = chain;
                while (currentForm) {
                    const pokemonResponse = await axios.get(`https://pokeapi.co/api/v2/pokemon/${currentForm.species.name}`);
                    forms.push({
                        name: currentForm.species.name,
                        image: pokemonResponse.data.sprites.front_default,
                        evolutionDetails: currentForm.evolution_details[0]
                    });
                    currentForm = currentForm.evolves_to[0];
                }

                evolutionCache.set(cacheKey, forms);
                return forms;
            };

            const showDetails = async (pokemon) => {
                try {
                    const response = await axios.get(pokemon.url);
                    const data = response.data;
                    const speciesResponse = await axios.get(data.species.url);
                    const evolutionChainUrl = speciesResponse.data.evolution_chain.url;
                    const evolutionResponse = await axios.get(evolutionChainUrl);
                    const evolutionChain = evolutionResponse.data.chain;

                    const forms = await getEvolutionForms(evolutionChain);
                    currentEvolutionIndex.value = forms.findIndex(form => form.name === pokemon.name);

                    selectedPokemon.value = {
                        name: data.name,
                        forms: forms,
                        height: data.height,
                        weight: data.weight,
                        abilities: data.abilities.map(a => a.ability.name),
                        stats: data.stats.map(s => ({
                            name: s.stat.name,
                            value: s.base_stat
                        })),
                        evolutionInfo: forms[currentEvolutionIndex.value].evolutionDetails
                            ? `Evolves at level ${forms[currentEvolutionIndex.value].evolutionDetails.min_level || 'unknown'}`
                            : 'Base form'
                    };
                } catch (error) {
                    console.error('Error fetching Pokemon details:', error);
                }
            };

            const showEvolutionDetails = (index) => {
                currentEvolutionIndex.value = index;
                const form = selectedPokemon.value.forms[index];
                selectedPokemon.value = {
                    ...selectedPokemon.value,
                    name: form.name,
                    evolutionInfo: form.evolutionDetails
                        ? `Evolves at level ${form.evolutionDetails.min_level || 'unknown'}`
                        : 'Base form'
                };
            };

                        const navigateEvolution = (direction) => {
                if (direction === 'next' && currentEvolutionIndex.value < selectedPokemon.value.forms.length - 1) {
                    currentEvolutionIndex.value++;
                } else if (direction === 'prev' && currentEvolutionIndex.value > 0) {
                    currentEvolutionIndex.value--;
                }
                showEvolutionDetails(currentEvolutionIndex.value);
            };

            const searchPokemon = () => {
                if (searchQuery.value.trim() === '') {
                    pokemonList.value = allPokemon.value.slice(0, 20);
                } else {
                    const query = searchQuery.value.toLowerCase();
                    pokemonList.value = allPokemon.value.filter(pokemon => 
                        pokemon.name.toLowerCase().includes(query)
                    ).slice(0, 20);
                }
            };

            const displayedPokemon = computed(() => {
                if (searchQuery.value.trim() === '') {
                    return pokemonList.value;
                } else {
                    const query = searchQuery.value.toLowerCase();
                    return allPokemon.value.filter(pokemon => 
                        pokemon.name.toLowerCase().includes(query)
                    ).slice(0, 20);
                }
            });

            const canNavigatePrev = computed(() => currentEvolutionIndex.value > 0);
            const canNavigateNext = computed(() => currentEvolutionIndex.value < selectedPokemon.value?.forms.length - 1);

            onMounted(() => {
                fetchAllPokemon();
            });

            watch(searchQuery, searchPokemon);

            return {
                pokemonList,
                nextUrl,
                prevUrl,
                isLoading,
                selectedPokemon,
                searchQuery,
                displayedPokemon,
                currentEvolutionIndex,
                loadNext,
                loadPrevious,
                showDetails,
                showEvolutionDetails,
                searchPokemon,
                navigateEvolution,
                canNavigatePrev,
                canNavigateNext
            };
        }
    }).mount('#app');
    </script>
</body>
</html>